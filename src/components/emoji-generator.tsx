"use client";

import { useState, useRef, useEffect } from "react";
import {
  Card,
  CardContent,
  CardDescription,
  CardFooter,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Label } from "@/components/ui/label";
import { Input } from "@/components/ui/input";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Wand2, Copy, Check } from "lucide-react";
import { useToast } from "@/hooks/use-toast";
import { Alert, AlertDescription, AlertTitle } from "./ui/alert";
import { useRateLimiter } from "@/hooks/use-rate-limiter";
import { generateEmojis } from "@/app/actions/emoji-generator-action";
import { useSettings } from "@/context/SettingsContext";
import { useRandomizerAudio } from "@/context/RandomizerAudioContext";
import { useAuth } from "@/context/AuthContext";
import { sendGTMEvent } from "@next/third-parties/google";
import { threwConfetti } from "@/lib/confetti";

const EMOJI_CATEGORIES = {
  "Smileys & Emotion": [
    "ğŸ˜€",
    "ğŸ˜ƒ",
    "ğŸ˜„",
    "ğŸ˜",
    "ğŸ˜†",
    "ğŸ˜…",
    "ğŸ˜‚",
    "ğŸ¤£",
    "ğŸ˜Š",
    "ğŸ˜‡",
    "ğŸ™‚",
    "ğŸ™ƒ",
    "ğŸ˜‰",
    "ğŸ˜Œ",
    "ğŸ˜",
    "ğŸ¥°",
    "ğŸ˜˜",
    "ğŸ˜—",
    "ğŸ˜™",
    "ğŸ˜š",
    "ğŸ˜‹",
    "ğŸ˜›",
    "ğŸ˜œ",
    "ğŸ¤ª",
    "ğŸ¤¨",
    "ğŸ§",
    "ğŸ¤“",
    "ğŸ˜",
    "ğŸ¥¸",
    "ğŸ¤©",
    "ğŸ¥³",
    "ğŸ˜",
    "ğŸ˜’",
    "ğŸ˜",
    "ğŸ˜”",
    "ğŸ˜Ÿ",
    "ğŸ˜•",
    "ğŸ™",
    "â˜¹ï¸",
    "ğŸ˜£",
    "ğŸ˜–",
    "ğŸ˜«",
    "ğŸ˜©",
    "ğŸ¥º",
    "ğŸ˜¢",
    "ğŸ˜­",
    "ğŸ˜¤",
    "ğŸ˜ ",
    "ğŸ˜¡",
    "ğŸ¤¬",
    "ğŸ¤¯",
    "ğŸ˜³",
    "ğŸ¥µ",
    "ğŸ¥¶",
    "ğŸ˜±",
    "ğŸ˜¨",
    "ğŸ˜°",
    "ğŸ˜¥",
    "ğŸ˜“",
    "ğŸ¤—",
    "ğŸ¤”",
    "ğŸ¤­",
    "ğŸ¤«",
    "ğŸ¤¥",
    "ğŸ˜¶",
    "ğŸ˜",
    "ğŸ˜‘",
    "ğŸ˜¬",
    "ğŸ™„",
    "ğŸ˜¯",
    "ğŸ˜¦",
    "ğŸ˜§",
    "ğŸ˜®",
    "ğŸ˜²",
    "ğŸ¥±",
    "ğŸ˜´",
    "ğŸ¤¤",
    "ğŸ˜ª",
    "ğŸ˜µ",
    "ğŸ¤",
    "ğŸ¥´",
    "ğŸ¤¢",
    "ğŸ¤®",
    "ğŸ¤§",
    "ğŸ˜·",
    "ğŸ¤’",
    "ğŸ¤•",
    "ğŸ¤‘",
    "ğŸ¤ ",
    "ğŸ˜ˆ",
    "ğŸ‘¿",
    "ğŸ‘¹",
    "ğŸ‘º",
    "ğŸ¤¡",
    "ğŸ’©",
    "ğŸ‘»",
    "ğŸ’€",
    "â˜ ï¸",
    "ğŸ‘½",
    "ğŸ‘¾",
    "ğŸ¤–",
    "ğŸƒ",
    "ğŸ˜º",
    "ğŸ˜¸",
    "ğŸ˜¹",
    "ğŸ˜»",
    "ğŸ˜¼",
    "ğŸ˜½",
    "ğŸ™€",
    "ğŸ˜¿",
    "ğŸ˜¾",
  ],
  "People & Body": [
    "ğŸ‘‹",
    "ğŸ¤š",
    "ğŸ–ï¸",
    "âœ‹",
    "ğŸ––",
    "ğŸ‘Œ",
    "ğŸ¤",
    "âœŒï¸",
    "ğŸ¤",
    "ğŸ¤Ÿ",
    "ğŸ¤˜",
    "ğŸ¤™",
    "ğŸ‘ˆ",
    "ğŸ‘‰",
    "ğŸ‘†",
    "ğŸ–•",
    "ğŸ‘‡",
    "â˜ï¸",
    "ğŸ‘",
    "ğŸ‘",
    "âœŠ",
    "ğŸ‘Š",
    "ğŸ¤›",
    "ğŸ¤œ",
    "ğŸ‘",
    "ğŸ™Œ",
    "ğŸ‘",
    "ğŸ¤²",
    "ğŸ¤",
    "ğŸ™",
    "âœï¸",
    "ğŸ’…",
    "ğŸ¤³",
    "ğŸ’ª",
    "ğŸ¦¾",
    "ğŸ¦µ",
    "ğŸ¦¿",
    "ğŸ¦¶",
    "ğŸ‘‚",
    "ğŸ¦»",
    "ğŸ‘ƒ",
    "ğŸ§ ",
    "ğŸ¦·",
    "ğŸ¦´",
    "ğŸ‘€",
    "ğŸ‘ï¸",
    "ğŸ‘…",
    "ğŸ‘„",
    "ğŸ‘¶",
    "ğŸ§’",
    "ğŸ‘¦",
    "ğŸ‘§",
    "ğŸ§‘",
    "ğŸ‘±",
    "ğŸ‘¨",
    "ğŸ§”",
    "ğŸ‘¨â€ğŸ¦°",
    "ğŸ‘¨â€ğŸ¦±",
    "ğŸ‘¨â€ğŸ¦³",
    "ğŸ‘¨â€ğŸ¦²",
    "ğŸ‘©",
    "ğŸ‘©â€ğŸ¦°",
    "ğŸ‘©â€ğŸ¦±",
    "ğŸ‘©â€ğŸ¦³",
    "ğŸ‘©â€ğŸ¦²",
    "ğŸ‘±â€â™€ï¸",
    "ğŸ‘±â€â™‚ï¸",
    "ğŸ§“",
    "ğŸ‘´",
    "ğŸ‘µ",
    "ğŸ™",
    "ğŸ™",
    "ğŸ™…",
    "ğŸ™†",
    "ğŸ’",
    "ğŸ™‹",
    "ğŸ§",
    "ğŸ™‡",
    "ğŸ¤¦",
    "ğŸ¤·",
    "ğŸ‘®",
    "ğŸ•µï¸",
    "ğŸ’‚",
    "ğŸ¥·",
    "ğŸ‘·",
    "ğŸ¤´",
    "ğŸ‘¸",
    "ğŸ‘³",
    "ğŸ‘²",
    "ğŸ§•",
    "ğŸ¤µ",
    "ğŸ‘°",
    "ğŸ¤°",
    "ğŸ¤±",
    "ğŸ§‘â€ğŸ¼",
    "ğŸ‘¼",
    "ğŸ…",
    "ğŸ¤¶",
    "ğŸ§‘â€ğŸ„",
    "ğŸ¦¸",
    "ğŸ¦¹",
    "ğŸ§™",
    "ğŸ§š",
    "ğŸ§›",
    "ğŸ§œ",
    "ğŸ§",
    "ğŸ§",
    "ğŸ§Ÿ",
  ],
  "Animals & Nature": [
    "ğŸ¶",
    "ğŸ±",
    "ğŸ­",
    "ğŸ¹",
    "ğŸ°",
    "ğŸ¦Š",
    "ğŸ»",
    "ğŸ¼",
    "ğŸ¨",
    "ğŸ¯",
    "ğŸ¦",
    "ğŸ®",
    "ğŸ·",
    "ğŸ½",
    "ğŸ¸",
    "ğŸµ",
    "ğŸ™ˆ",
    "ğŸ™‰",
    "ğŸ™Š",
    "ğŸ’",
    "ğŸ”",
    "ğŸ§",
    "ğŸ¦",
    "ğŸ¤",
    "ğŸ£",
    "ğŸ¥",
    "ğŸ¦†",
    "ğŸ¦…",
    "ğŸ¦‰",
    "ğŸ¦‡",
    "ğŸº",
    "ğŸ—",
    "ğŸ´",
    "ğŸ¦„",
    "ğŸ",
    "ğŸ›",
    "ğŸ¦‹",
    "ğŸŒ",
    "ğŸ",
    "ğŸœ",
    "ğŸ¦Ÿ",
    "ğŸ¦—",
    "ğŸ•·ï¸",
    "ğŸ¦‚",
    "ğŸ¢",
    "ğŸ",
    "ğŸ¦",
    "ğŸ¦–",
    "ğŸ¦•",
    "ğŸ™",
    "ğŸ¦‘",
    "ğŸ¦",
    "ğŸ¦",
    "ğŸ¦€",
    "ğŸ¡",
    "ğŸ ",
    "ğŸŸ",
    "ğŸ¬",
    "ğŸ³",
    "ğŸ‹",
    "ğŸ¦ˆ",
    "ğŸŠ",
    "ğŸ…",
    "ğŸ†",
    "ğŸ¦“",
    "ğŸ¦",
    "ğŸ¦§",
    "ğŸ˜",
    "ğŸ¦›",
    "ğŸ¦",
    "ğŸª",
    "ğŸ«",
    "ğŸ¦’",
    "ğŸ¦˜",
    "ğŸƒ",
    "ğŸ‚",
    "ğŸ„",
    "ğŸ",
    "ğŸ–",
    "ğŸ",
    "ğŸ‘",
    "ğŸ¦™",
    "ğŸ",
    "ğŸ¦Œ",
    "ğŸ•",
    "ğŸ©",
    "ğŸ¦®",
    "ğŸ•â€ğŸ¦º",
    "ğŸˆ",
    "ğŸˆâ€â¬›",
    "ğŸ“",
    "ğŸ¦ƒ",
    "ğŸ¦š",
    "ğŸ¦œ",
    "ğŸ¦¢",
    "ğŸ¦©",
    "ğŸ•Šï¸",
    "ğŸ‡",
    "ğŸ¦",
    "ğŸ¦¨",
    "ğŸ¦¡",
    "ğŸ¦¦",
    "ğŸ¦«",
    "ğŸ¿ï¸",
    "ğŸ¦”",
    "ğŸ¾",
    "ğŸ‰",
    "ğŸ²",
    "ğŸŒµ",
    "ğŸ„",
    "ğŸŒ²",
    "ğŸŒ³",
    "ğŸŒ´",
    "ğŸŒ±",
    "ğŸŒ¿",
    "â˜˜ï¸",
    "ğŸ€",
    "ğŸ",
    "ğŸª´",
    "ğŸ‹",
    "ğŸƒ",
    "ğŸ‚",
    "ğŸ",
    "ğŸ„",
    "ğŸš",
    "ğŸŒ¾",
    "ğŸ’",
    "ğŸŒ·",
    "ğŸŒ¹",
    "ğŸ¥€",
    "ğŸŒº",
    "ğŸŒ¸",
    "ğŸŒ¼",
    "ğŸŒ»",
    "ğŸŒ",
    "ğŸŒ",
    "ğŸŒ›",
    "ğŸŒœ",
    "ğŸŒš",
    "ğŸŒ•",
    "ğŸŒ–",
    "ğŸŒ—",
    "ğŸŒ˜",
    "ğŸŒ‘",
    "ğŸŒ’",
    "ğŸŒ“",
    "ğŸŒ”",
    "ğŸŒ™",
    "ğŸŒ",
    "ğŸŒ",
    "ğŸŒ",
    "ğŸ’«",
    "â­",
    "ğŸŒŸ",
    "âœ¨",
    "âš¡",
    "â˜„ï¸",
    "ğŸ’¥",
    "ğŸ”¥",
    "ğŸŒªï¸",
    "ğŸŒˆ",
    "â˜€ï¸",
    "ğŸŒ¤ï¸",
    "â›…",
    "ğŸŒ¥ï¸",
    "â˜ï¸",
    "ğŸŒ¦ï¸",
    "ğŸŒ§ï¸",
    "â›ˆï¸",
    "ğŸŒ©ï¸",
    "ğŸŒ¨ï¸",
    "â„ï¸",
    "â˜ƒï¸",
    "â›„",
    "ğŸŒ¬ï¸",
    "ğŸ’¨",
    "ğŸ’§",
    "ğŸ’¦",
    "ğŸŒŠ",
  ],
  "Food & Drink": [
    "ğŸ‡",
    "ğŸˆ",
    "ğŸ‰",
    "ğŸŠ",
    "ğŸ‹",
    "ğŸŒ",
    "ğŸ",
    "ğŸ¥­",
    "ğŸ",
    "ğŸ",
    "ğŸ",
    "ğŸ‘",
    "ğŸ’",
    "ğŸ“",
    "ğŸ¥",
    "ğŸ…",
    "ğŸ¥¥",
    "ğŸ¥‘",
    "ğŸ†",
    "ğŸ¥”",
    "ğŸ¥•",
    "ğŸŒ½",
    "ğŸŒ¶ï¸",
    "ğŸ¥’",
    "ğŸ¥¬",
    "ğŸ¥¦",
    "ğŸ§„",
    "ğŸ§…",
    "ğŸ„",
    "ğŸ¥œ",
    "ğŸŒ°",
    "ğŸ",
    "ğŸ¥",
    "ğŸ¥–",
    "ğŸ¥¨",
    "ğŸ¥¯",
    "ğŸ¥",
    "ğŸ§‡",
    "ğŸ§€",
    "ğŸ–",
    "ğŸ—",
    "ğŸ¥©",
    "ğŸ¥“",
    "ğŸ”",
    "ğŸŸ",
    "ğŸ•",
    "ğŸŒ­",
    "ğŸ¥ª",
    "ğŸŒ®",
    "ğŸŒ¯",
    "ğŸ¥™",
    "ğŸ§†",
    "ğŸ¥š",
    "ğŸ³",
    "ğŸ¥˜",
    "ğŸ²",
    "ğŸ¥£",
    "ğŸ¥—",
    "ğŸ¿",
    "ğŸ§ˆ",
    "ğŸ§‚",
    "ğŸ¥«",
    "ğŸ±",
    "ğŸ˜",
    "ğŸ™",
    "ğŸš",
    "ğŸ›",
    "ğŸœ",
    "ğŸ",
    "ğŸ ",
    "ğŸ¢",
    "ğŸ£",
    "ğŸ¤",
    "ğŸ¥",
    "ğŸ¥®",
    "ğŸ¡",
    "ğŸ¥Ÿ",
    "ğŸ¥ ",
    "ğŸ¥¡",
    "ğŸ¦€",
    "ğŸ¦",
    "ğŸ¦",
    "ğŸ¦‘",
    "ğŸ¦ª",
    "ğŸ¦",
    "ğŸ§",
    "ğŸ¨",
    "ğŸ©",
    "ğŸª",
    "ğŸ‚",
    "ğŸ°",
    "ğŸ§",
    "ğŸ¥§",
    "ğŸ«",
    "ğŸ¬",
    "ğŸ­",
    "ğŸ®",
    "ğŸ¯",
    "ğŸ¼",
    "ğŸ¥›",
    "â˜•",
    "ğŸµ",
    "ğŸ¶",
    "ğŸ¾",
    "ğŸ·",
    "ğŸ¸",
    "ğŸ¹",
    "ğŸº",
    "ğŸ»",
    "ğŸ¥‚",
    "ğŸ¥ƒ",
    "ğŸ¥¤",
    "ğŸ§ƒ",
    "ğŸ§‰",
    "ğŸ§Š",
  ],
  Activities: [
    "âš½",
    "ğŸ€",
    "ğŸˆ",
    "âš¾",
    "ğŸ¥",
    "ğŸ¾",
    "ğŸ",
    "ğŸ‰",
    "ğŸ¥",
    "ğŸ±",
    "ğŸ“",
    "ğŸ¸",
    "ğŸ’",
    "ğŸ‘",
    "ğŸ¥",
    "ğŸ",
    "ğŸ¥…",
    "â›³",
    "ğŸª",
    "ğŸ¹",
    "ğŸ£",
    "ğŸ¤¿",
    "ğŸ¥Š",
    "ğŸ¥‹",
    "ğŸ½",
    "ğŸ›¹",
    "ğŸ›·",
    "â›¸ï¸",
    "ğŸ¥Œ",
    "ğŸ¿",
    "â›·ï¸",
    "ğŸª‚",
    "ğŸ‹ï¸",
    "ğŸ¤¼",
    "ğŸ¤¸",
    "ğŸ¤º",
    "ğŸ¤¾",
    "ğŸŒï¸",
    "ğŸ‡",
    "ğŸ§˜",
    "ğŸ„",
    "ğŸŠ",
    "ğŸ¤½",
    "ğŸš£",
    "ğŸ§—",
    "ğŸš´",
    "ğŸšµ",
    "ğŸª",
    "ğŸ¤¹",
    "ğŸ­",
    "ğŸ¨",
    "ğŸ¬",
    "ğŸ¤",
    "ğŸ§",
    "ğŸ¼",
    "ğŸ¹",
    "ğŸ¥",
    "ğŸ·",
    "ğŸº",
    "ğŸ¸",
    "ğŸª•",
    "ğŸ»",
    "ğŸ²",
    "â™Ÿï¸",
    "ğŸ¯",
    "ğŸ³",
    "ğŸ®",
    "ğŸ°",
  ],
  "Travel & Places": [
    "ğŸš—",
    "ğŸš•",
    "ğŸš™",
    "ğŸšŒ",
    "ğŸš",
    "ğŸï¸",
    "ğŸš“",
    "ğŸš‘",
    "ğŸš’",
    "ğŸš",
    "ğŸšš",
    "ğŸš›",
    "ğŸšœ",
    "ğŸ›´",
    "ğŸš²",
    "ğŸ›µ",
    "ğŸï¸",
    "ğŸ›º",
    "ğŸš”",
    "ğŸš",
    "ğŸš˜",
    "ğŸš–",
    "ğŸš¡",
    "ğŸš ",
    "ğŸšŸ",
    "ğŸšƒ",
    "ğŸš‹",
    "ğŸš",
    "ğŸš",
    "ğŸš„",
    "ğŸš…",
    "ğŸšˆ",
    "ğŸš‚",
    "ğŸš†",
    "ğŸš‡",
    "ğŸšŠ",
    "ğŸš‰",
    "âœˆï¸",
    "ğŸ›«",
    "ğŸ›¬",
    "ğŸ’º",
    "ğŸ›°ï¸",
    "ğŸš€",
    "ğŸ›¸",
    "ğŸš",
    "ğŸ›¶",
    "â›µ",
    "ğŸš¤",
    "ğŸ›¥ï¸",
    "ğŸ›³ï¸",
    "â›´ï¸",
    "ğŸš¢",
    "âš“",
    "â›½",
    "ğŸš§",
    "ğŸš¦",
    "ğŸš¥",
    "ğŸ›‘",
    "ğŸ—¿",
    "ğŸ—½",
    "ğŸ—¼",
    "ğŸ°",
    "ğŸ¯",
    "ğŸŸï¸",
    "ğŸ¡",
    "ğŸ¢",
    "ğŸ ",
    "â›²",
    "â›±ï¸",
    "ğŸ–ï¸",
    "ğŸï¸",
    "ğŸœï¸",
    "ğŸŒ‹",
    "â›°ï¸",
    "ğŸ”ï¸",
    "ğŸ—»",
    "ğŸ•ï¸",
    "â›º",
    "ğŸ ",
    "ğŸ¡",
    "ğŸ˜ï¸",
    "ğŸšï¸",
    "ğŸ—ï¸",
    "ğŸ­",
    "ğŸ¢",
    "ğŸ¬",
    "ğŸ£",
    "ğŸ¤",
    "ğŸ¥",
    "ğŸ¦",
    "ğŸ¨",
    "ğŸª",
    "ğŸ«",
    "ğŸ©",
    "ğŸ’’",
    "ğŸ›ï¸",
    "â›ª",
    "ğŸ•Œ",
    "ğŸ•",
    "ğŸ›•",
    "ğŸ•‹",
    "â›©ï¸",
    "ğŸ›¤ï¸",
    "ğŸ›£ï¸",
    "ğŸ—¾",
    "ğŸ—ºï¸",
    "ğŸ‘",
    "ğŸï¸",
    "ğŸŒ…",
    "ğŸŒ„",
    "ğŸŒ ",
    "ğŸ‡",
    "ğŸ†",
    "ğŸŒ‡",
    "ğŸŒ†",
    "ğŸ™ï¸",
    "ğŸŒƒ",
    "ğŸŒŒ",
    "ğŸŒ‰",
    "ğŸŒ",
  ],
  Objects: [
    "âŒš",
    "ğŸ“±",
    "ğŸ“²",
    "ğŸ’»",
    "âŒ¨ï¸",
    "ğŸ–¥ï¸",
    "ğŸ–¨ï¸",
    "ğŸ–±ï¸",
    "ğŸ–²ï¸",
    "ğŸ•¹ï¸",
    "ğŸ—œï¸",
    "ğŸ’½",
    "ğŸ’¾",
    "ğŸ’¿",
    "ğŸ“€",
    "ğŸ“¼",
    "ğŸ“·",
    "ğŸ“¸",
    "ğŸ“¹",
    "ğŸ¥",
    "ğŸï¸",
    "ğŸ“",
    "â˜ï¸",
    "ğŸ“Ÿ",
    "ğŸ“ ",
    "ğŸ“º",
    "ğŸ“»",
    "ğŸ™ï¸",
    "ğŸšï¸",
    "ğŸ›ï¸",
    "ğŸ§­",
    "â±ï¸",
    "â²ï¸",
    "â°",
    "ğŸ•°ï¸",
    "â³",
    "âŒ›",
    "ğŸ“¡",
    "ğŸ”‹",
    "ğŸ”Œ",
    "ğŸ’¡",
    "ğŸ”¦",
    "ğŸ•¯ï¸",
    "ğŸª”",
    "ğŸ§¯",
    "ğŸ›¢ï¸",
    "ğŸ’¸",
    "ğŸ’µ",
    "ğŸ’´",
    "ğŸ’¶",
    "ğŸ’·",
    "ğŸ’°",
    "ğŸ’³",
    "ğŸ’",
    "âš–ï¸",
    "ğŸ¦¯",
    "ğŸ§°",
    "ğŸ”§",
    "ğŸ”¨",
    "âš’ï¸",
    "ğŸ› ï¸",
    "â›ï¸",
    "ğŸ”©",
    "âš™ï¸",
    "ğŸ§±",
    "â›“ï¸",
    "ğŸ§²",
    "ğŸ”«",
    "ğŸ’£",
    "ğŸ§¨",
    "ğŸª“",
    "ğŸ”ª",
    "ğŸ—¡ï¸",
    "âš”ï¸",
    "ğŸ›¡ï¸",
    "ğŸš¬",
    "âš°ï¸",
    "âš±ï¸",
    "ğŸº",
    "ğŸ”®",
    "ğŸ“¿",
    "ğŸ§¿",
    "ğŸ’ˆ",
    "âš—ï¸",
    "ğŸ”­",
    "ğŸ”¬",
    "ğŸ•³ï¸",
    "ğŸ’Š",
    "ğŸ’‰",
    "ğŸ©¸",
    "ğŸ§¬",
    "ğŸ¦ ",
    "ğŸ§«",
    "ğŸ§ª",
    "ğŸŒ¡ï¸",
    "ğŸ§¹",
    "ğŸ§º",
    "ğŸ§»",
    "ğŸš½",
    "ğŸš°",
    "ğŸš¿",
    "ğŸ›",
    "ğŸ›€",
    "ğŸ§¼",
    "ğŸª’",
    "ğŸ§½",
    "ğŸª£",
    "ğŸ”‘",
    "ğŸ—ï¸",
    "ğŸ›‹ï¸",
    "ğŸª‘",
    "ğŸ›Œ",
    "ğŸ›ï¸",
    "ğŸšª",
    "ğŸª",
    "ğŸªŸ",
    "ğŸ§³",
    "ğŸ–¼ï¸",
    "ğŸ§­",
    "ğŸ—ºï¸",
    "â›±ï¸",
    "ğŸ—¿",
    "ğŸ§¥",
    "ğŸ¥¼",
    "ğŸ¦º",
    "ğŸ‘š",
    "ğŸ‘•",
    "ğŸ‘–",
    "ğŸ©²",
    "ğŸ©³",
    "ğŸ‘™",
    "ğŸ‘˜",
    "ğŸ¥»",
    "ğŸ©±",
    "ğŸ¥¿",
    "ğŸ‘ ",
    "ğŸ‘¡",
    "ğŸ‘¢",
    "ğŸ‘",
    "ğŸ‘Ÿ",
    "ğŸ¥¾",
    "ğŸ§¦",
    "ğŸ§¤",
    "ğŸ§£",
    "ğŸ©",
    "ğŸ§¢",
    "ğŸ‘’",
    "ğŸ“",
    "â›‘ï¸",
    "ğŸ‘‘",
    "ğŸ’",
    "ğŸ‘",
    "ğŸ‘›",
    "ğŸ‘œ",
    "ğŸ’¼",
    "ğŸ’",
    "ğŸ‘“",
    "ğŸ•¶ï¸",
    "ğŸ¥½",
    "ğŸŒ‚",
  ],
  Symbols: [
    "â¤ï¸",
    "ğŸ§¡",
    "ğŸ’›",
    "ğŸ’š",
    "ğŸ’™",
    "ğŸ’œ",
    "ğŸ–¤",
    "ğŸ¤",
    "ğŸ¤",
    "ğŸ’”",
    "â£ï¸",
    "ğŸ’•",
    "ğŸ’",
    "ğŸ’“",
    "ğŸ’—",
    "ğŸ’–",
    "ğŸ’˜",
    "ğŸ’",
    "ğŸ’Ÿ",
    "â˜®ï¸",
    "âœï¸",
    "â˜ªï¸",
    "ğŸ•‰ï¸",
    "â˜¸ï¸",
    "âœ¡ï¸",
    "ğŸ”¯",
    "ğŸ•",
    "â˜¯ï¸",
    "â˜¦ï¸",
    "ğŸ›",
    "â›",
    "â™ˆ",
    "â™‰",
    "â™Š",
    "â™‹",
    "â™Œ",
    "â™",
    "â™",
    "â™",
    "â™",
    "â™‘",
    "â™’",
    "â™“",
    "ğŸ†”",
    "âš›ï¸",
    "ğŸ‰‘",
    "â˜¢ï¸",
    "â˜£ï¸",
    "ğŸ“´",
    "ğŸ“³",
    "ğŸˆ¶",
    "ğŸˆš",
    "ğŸˆ¸",
    "ğŸˆº",
    "ğŸˆ·ï¸",
    "âœ´ï¸",
    "ğŸ†š",
    "ğŸ’®",
    "ğŸ‰",
    "ãŠ™ï¸",
    "ãŠ—ï¸",
    "ğŸˆ´",
    "ğŸˆµ",
    "ğŸˆ¹",
    "ğŸˆ²",
    "ğŸ…°ï¸",
    "ğŸ…±ï¸",
    "ğŸ†",
    "ğŸ†‘",
    "ğŸ…¾ï¸",
    "ğŸ†˜",
    "âŒ",
    "â­•",
    "ğŸ›‘",
    "â›”",
    "ğŸ“›",
    "ğŸš«",
    "ğŸ’¯",
    "ğŸ’¢",
    "â™¨ï¸",
    "ğŸš·",
    "ğŸš¯",
    "ğŸš³",
    "ğŸš±",
    "ğŸ”",
    "ğŸ“µ",
    "ğŸš­",
    "â—ï¸",
    "â•",
    "â“",
    "â”",
    "â€¼ï¸",
    "â‰ï¸",
    "ğŸ”…",
    "ğŸ”†",
    "ã€½ï¸",
    "âš ï¸",
    "ğŸš¸",
    "ğŸ”±",
    "âšœï¸",
    "ğŸ”°",
    "â™»ï¸",
    "âœ…",
    "ğŸˆ¯",
    "ğŸ’¹",
    "â‡ï¸",
    "âœ³ï¸",
    "â",
    "ğŸŒ",
    "ğŸ’ ",
    "â“‚ï¸",
    "ğŸŒ€",
    "ğŸ’¤",
    "ğŸ§",
    "ğŸš¾",
    "â™¿",
    "ğŸ…¿ï¸",
    "ğŸˆ³",
    "ğŸˆ‚ï¸",
    "ğŸ›‚",
    "ğŸ›ƒ",
    "ğŸ›„",
    "ğŸ›…",
    "ğŸš¹",
    "ğŸšº",
    "ğŸš¼",
    "ğŸš»",
    "ğŸš®",
    "ğŸ¦",
    "ğŸ“¶",
    "ğŸˆ",
    "ğŸ”£",
    "â„¹ï¸",
    "ğŸ”¤",
    "ğŸ”¡",
    "ğŸ” ",
    "ğŸ†–",
    "ğŸ†—",
    "ğŸ†™",
    "ğŸ†’",
    "ğŸ†•",
    "ğŸ†“",
    "0ï¸âƒ£",
    "1ï¸âƒ£",
    "2ï¸âƒ£",
    "3ï¸âƒ£",
    "4ï¸âƒ£",
    "5ï¸âƒ£",
    "6ï¸âƒ£",
    "7ï¸âƒ£",
    "8ï¸âƒ£",
    "9ï¸âƒ£",
    "ğŸ”Ÿ",
    "ğŸ”¢",
    "#ï¸âƒ£",
    "*ï¸âƒ£",
    "âï¸",
    "â–¶ï¸",
    "â¸ï¸",
    "â¯ï¸",
    "â¹ï¸",
    "âºï¸",
    "â­ï¸",
    "â®ï¸",
    "â©",
    "âª",
    "â«",
    "â¬",
    "â—€ï¸",
    "ğŸ”¼",
    "ğŸ”½",
    "â¡ï¸",
    "â¬…ï¸",
    "â¬†ï¸",
    "â¬‡ï¸",
    "â†—ï¸",
    "â†˜ï¸",
    "â†™ï¸",
    "â†–ï¸",
    "â†•ï¸",
    "â†”ï¸",
    "â†ªï¸",
    "â†©ï¸",
    "â¤´ï¸",
    "â¤µï¸",
    "ğŸ”€",
    "ğŸ”",
    "ğŸ”‚",
    "ğŸ”„",
    "ğŸ”ƒ",
    "ğŸµ",
    "ğŸ¶",
    "â•",
    "â–",
    "â—",
    "âœ–ï¸",
    "â™¾ï¸",
    "ğŸ’²",
    "ğŸ’±",
    "â„¢ï¸",
    "Â©ï¸",
    "Â®ï¸",
    "ã€°ï¸",
    "â°",
    "â¿",
    "ğŸ”š",
    "ğŸ”™",
    "ğŸ”›",
    "ğŸ”",
    "ğŸ”œ",
    "âœ”ï¸",
    "â˜‘ï¸",
    "ğŸ”˜",
    "ğŸ”´",
    "ğŸŸ ",
    "ğŸŸ¡",
    "ğŸŸ¢",
    "ğŸ”µ",
    "ğŸŸ£",
    "âš«",
    "âšª",
    "ğŸŸ¤",
    "ğŸ”º",
    "ğŸ”»",
    "ğŸ”¼",
    "ğŸ”½",
    "ğŸ”³",
    "ğŸ”²",
    "â–ªï¸",
    "â–«ï¸",
    "â—¾",
    "â—½",
    "â—¼ï¸",
    "â—»ï¸",
    "ğŸŸ¥",
    "ğŸŸ§",
    "ğŸŸ¨",
    "ğŸŸ©",
    "ğŸŸ¦",
    "ğŸŸª",
    "â¬›",
    "â¬œ",
    "ğŸŸ«",
    "ğŸ”¶",
    "ğŸ”·",
    "ğŸ”¸",
    "ğŸ”¹",
    "â–ªï¸",
    "â–«ï¸",
  ],
};

export default function EmojiGenerator() {
  const [count, setCount] = useState("5");
  const [category, setCategory] = useState("all");
  const [result, setResult] = useState<string[] | null>(null);
  const [isGenerating, setIsGenerating] = useState(false);
  const [isCopied, setIsCopied] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const { toast } = useToast();
  const [isRateLimited, triggerRateLimit] = useRateLimiter(3000);
  const { animationDuration, confettiConfig } = useSettings();
  const animationIntervalRef = useRef<NodeJS.Timeout | null>(null);
  const { playAudio, stopAudio } = useRandomizerAudio();
  const { user } = useAuth();

  useEffect(() => {
    if (!isGenerating) {
      stopAudio();
      if (animationIntervalRef.current) {
        clearInterval(animationIntervalRef.current);
      }
    }
  }, [isGenerating, stopAudio]);

  const handleGenerate = async () => {
    sendGTMEvent({
      event: "action_emoji_randomizer",
      user_email: user ? user.email : "guest",
    });
    if (isGenerating || isRateLimited) return;
    triggerRateLimit();
    playAudio();
    setError(null);
    setIsGenerating(true);
    setIsCopied(false);
    setResult(null);

    const numCount = parseInt(count, 10);
    if (isNaN(numCount) || numCount <= 0 || numCount > 50) {
      setError("Please enter a number between 1 and 50.");
      setIsGenerating(false);
      return;
    }

    animationIntervalRef.current = setInterval(async () => {
      const tempResult = await generateEmojis(numCount, category);
      setResult(tempResult);
    }, 100);

    try {
      const finalResult = await generateEmojis(numCount, category);
      setTimeout(() => {
        if (animationIntervalRef.current)
          clearInterval(animationIntervalRef.current);
        setResult(finalResult);
        setIsGenerating(false);
        if (confettiConfig.enabled) {
          threwConfetti({
            particleCount: confettiConfig.particleCount,
            spread: confettiConfig.spread,
          });
        }
      }, animationDuration * 1000);
    } catch (e: any) {
      setError(e.message);
      if (animationIntervalRef.current)
        clearInterval(animationIntervalRef.current);
      setIsGenerating(false);
    }
  };

  const handleCopy = () => {
    if (!result) return;
    navigator.clipboard.writeText(result.join(""));
    setIsCopied(true);
    toast({
      title: "Copied!",
      description: "Emojis copied to clipboard.",
      duration: 2000,
    });
    setTimeout(() => setIsCopied(false), 2000);
  };

  return (
    <Card className="w-full shadow-lg border-none">
      <CardHeader>
        <CardTitle>Emoji Generator</CardTitle>
        <CardDescription>
          Generate a random sequence of fun emojis.
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-6">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div className="flex items-center gap-2">
            <Label htmlFor="emoji-count">Number of Emojis</Label>
            <Input
              id="emoji-count"
              type="number"
              min="1"
              max="50"
              value={count}
              onChange={(e) => setCount(e.target.value)}
              className="w-20"
              disabled={isGenerating || isRateLimited}
            />
          </div>
          <div className="flex items-center gap-2">
            <Label htmlFor="emoji-category">Category</Label>
            <Select
              value={category}
              onValueChange={setCategory}
              disabled={isGenerating || isRateLimited}
            >
              <SelectTrigger id="emoji-category" className="w-full">
                <SelectValue placeholder="Category" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="all">All</SelectItem>
                {Object.keys(EMOJI_CATEGORIES).map((cat) => (
                  <SelectItem key={cat} value={cat}>
                    {cat}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
        </div>

        {(result || isGenerating) && (
          <div className="relative min-h-[160px] flex items-center justify-center bg-muted/50 rounded-lg p-4">
            <p className="text-6xl tracking-widest text-accent select-all flex flex-wrap justify-center gap-x-2 gap-y-6">
              {result?.map((emoji, index) => (
                <span key={index}>{emoji}</span>
              ))}
            </p>
            {result && !isGenerating && (
              <div className="absolute top-2 right-2">
                <Button variant="ghost" size="icon" onClick={handleCopy}>
                  {isCopied ? (
                    <Check className="h-5 w-5 text-green-500" />
                  ) : (
                    <Copy className="h-5 w-5" />
                  )}
                </Button>
              </div>
            )}
          </div>
        )}

        {error && (
          <Alert variant="destructive" className="mt-4">
            <AlertTitle>Error</AlertTitle>
            <AlertDescription>{error}</AlertDescription>
          </Alert>
        )}
      </CardContent>
      <CardFooter>
        <Button
          id="randomize-button"
          onClick={handleGenerate}
          disabled={isGenerating || isRateLimited}
          className="w-full bg-accent hover:bg-accent/90 text-accent-foreground"
        >
          <Wand2 className="mr-2 h-4 w-4" />
          {isGenerating
            ? "Generating..."
            : isRateLimited
              ? "Please wait..."
              : "Generate Emojis"}
        </Button>
      </CardFooter>
    </Card>
  );
}
